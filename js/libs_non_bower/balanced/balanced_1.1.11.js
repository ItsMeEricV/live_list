////
// balanced.js
// version: 1.1.11
// built: 2013-10-29
// https://github.com/balanced/balanced-js
////

!function(a,b){function c(a){a.meta||(a.meta={}),n.submitted=1*new Date,n.scrollX=window.scrollX,n.scrollY=window.scrollY;for(var b in n)"capabilities_"+b in a.meta||(a.meta["capabilities_"+b]=n[b]);return a}function d(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&(a["e"+b+c]=c,a[b+c]=function(){a["e"+b+c](window.event)},a.attachEvent("on"+b,a[b+c]))}function e(a){a=a?a:window.event;var b=!1;return a.shiftKey?b=a.shiftKey:a.modifiers&&(b=!!(4&a.modifiers)),b&&(o=!0),o}function f(a){if(null==a)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0}function g(a,b){var c={},d={};if("object"==typeof a)for(var e=0;e<a.length;e++)d[a[e]]=b;else d[a]=b;return c.description=b,c.extras=d,c}function h(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];b&&e in b&&b[e]||c.push(g(e,"Invalid field ["+e+'] - Missing field "'+e+'"'))}}function i(a,b,c){var d=[];h(b,a,d);var e=c(a);d=d.concat(e);for(var f=0;f<d.length;f++)d[f].status="Bad Request",d[f].category_code="request",d[f].additional=null,d[f].status_code=400,d[f].category_type="request";return d}function j(a,b){var c=b?b:"No data supplied";if(!a)throw c;a({errors:{description:c,status:"Bad Request",category_code:"request",additional:null,status_code:400,category_type:"request",extras:{}}})}function k(a,b){var c="balanced_jsonp_"+Math.random().toString().substr(2),d=document.createElement("script");d.type="text/javascript",d.async=!0,d.src=a.replace("{callback}",c);var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(d,e),window[c]=function(a){try{b(a)}catch(c){"undefined"!=typeof console&&console.error&&console.error(c)}d.parentNode.removeChild(d)}}function l(a,b){return s+a+"?callback={callback}&data="+encodeURI(JSON.stringify(b))}function m(a){function b(b){if(!c){if(c=!0,!b||!b.status)return a({description:"Unable to connect to the balanced servers",status:"Internal Server Error",category_code:"server-error",additional:null,status_code:500,category_type:"server-error",extras:{}}),void 0;var d=JSON.parse(b.body);"undefined"!=typeof b.status&&(d.status_code=b.status),a(d)}}var c=!1;return setTimeout(b,6e4),b}b.balanced=a;var n={system_timezone:-(new Date).getTimezoneOffset()/60,user_agent:navigator.userAgent,language:navigator.userLanguage||navigator.language,kp:0,cli:0,loaded:1*new Date,screen_width:screen.width,screen_length:screen.height,hist:window.history.length,cookie:function(){var a=document.cookie.match(/__b=([a-zA-Z0-9\-!\.]+)/);a=a?a[1]:1*new Date+"."+Math.random().toString().substr(2)+".0!0",a=a.split("!");var b=a[0].split(".");b.length<3&&(b[1]=Math.random().toString().substr(2),b[2]=0),b[2]++,a=b.join(".")+"!"+a[1];var c=new Date;return c.setDate(c.getDate()+365),document.cookie="__b="+a+" ;expires="+c.toUTCString(),a}()},o=!1;d(window,"keydown",function(a){n.cl||(n.cl=e(a)),n.kp++}),d(window,"paste",function(){n.ps=!0}),d(window,"click",function(){n.cli++}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var p={isCardNumberValid:function(a){if(!a)return!1;if(a=(a+"").replace(/\D+/g,"").split("").reverse(),!a.length||a.length<12)return!1;var b,c=0;for(b=0;b<a.length;b++)a[b]=parseInt(a[b],10),c+=b%2?2*a[b]-(a[b]>4?9:0):a[b];return 0===c%10},cardType:function(a){var b={};if(b["51"]=b["52"]=b["53"]=b["54"]=b["55"]="Mastercard",b["34"]=b["37"]="American Express",b["4"]="VISA",b["6"]="Discover Card",a){a=a.toString().trim();for(var c in b)if(0===a.indexOf(c))return b[c]}return null},isSecurityCodeValid:function(a,b){var c=p.cardType(a);if(!c)return!1;var d="American Express"===c?4:3;return"string"!=typeof b&&"number"!=typeof b||b.toString().replace(/\D+/g,"").length!==d?!1:!0},isExpiryValid:function(a,b){if(!a||!b)return!1;if(a=parseInt(a,10),b=parseInt(b,10),isNaN(a)||isNaN(b)||a>12||1>a)return!1;var c=new Date;return!(c.getFullYear()>b||c.getFullYear()===b&&c.getMonth()>=a)},validate:function(a){a.number&&(a.number=a.number.toString().trim());var b=a.number,c=a.cvv,d=a.expiration_month,e=a.expiration_year,f=[];return p.isCardNumberValid(b)||f.push(g("number",'Invalid field [number] - "'+b+'" is not a valid credit card number')),"undefined"==typeof c||null===c||p.isSecurityCodeValid(b,c)||f.push(g("cvv",'Invalid field [cvv] - "'+c+'" is not a valid credit card security code')),p.isExpiryValid(d,e)||f.push(g(["expiration_month","expiration_year"],'Invalid field [expiration_month,expiration_year] - "'+d+"-"+e+'" is not a valid credit card expiration date')),f},create:function(a,b){if(!a)return j(b),void 0;var d=["number","expiration_month","expiration_year"],e=i(a,d,p.validate);f(e)?k(l("/jsonp/cards",c(a)),m(b)):b({errors:e})}},q={validate:function(a){return a&&a.match(/[a-z0-9!#$%&'*+\/=?\^_`{|}~\-]+(?:\.[a-z0-9!#$%&'*+\/=?\^_`{|}~\-]+)*@(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?/i)?!0:!1}},r={types:["savings","checking"],validate:function(a){var b="routing_number"in a?"routing_number":"bank_code",c=a[b],d=[];return r.validateRoutingNumber(c)||d.push(g(b,"Invalid field ["+b+'] - "'+c+'" is not a valid '+b.replace("_"," "))),"type"in a&&!r.validateType(a.type)&&d.push(g("type",'Invalid field [type] - "'+a.type+'" must be one of: "'+r.types.join('", "')+'"')),d},validateRoutingNumber:function(a){if(!a)return!1;if(a=a.match(/\d+/g),!a)return!1;if(a=a.join(""),!a||9!==a.length)return!1;for(var b=a.toString().split(""),c=[],d=0;d<b.length;d++)c.push(parseInt(b[d],10));return c[8]===(7*(c[0]+c[3]+c[6])+3*(c[1]+c[4]+c[7])+9*(c[2]+c[5]))%10},lookupRoutingNumber:function(a,b){if(!a)return j(b),void 0;var c="/bank_accounts/routing_numbers/"+a;k(l(c,null,m(b)))},validateType:function(a){return a?r.types.indexOf(a)>=0:!0},create:function(a,b){if(!a)return j(b),void 0;var d=["name","account_number","routing_number"],e=i(a,d,r.validate);f(e)?k(l("/jsonp/bank_accounts",c(a)),m(b)):b({errors:e})}},s="https://api.balancedpayments.com";"object"!=typeof JSON&&k("https://js.balancedpayments.com/json2.js"),b.balanced={card:p,bankAccount:r,emailAddress:q,init:function(a){a&&"server"in a&&(s=a.server)}}}({},function(){return this}());